# Malware Finder #
A shitty but somewhat useful Python script which can be used to analyze memory
dumps by correlating the results of Volatility's plugins malfind, vadlist,
apihooks, ldrmodules etc.

This script creates a cache file for each Volatility operation per image. This
way each Volatility command only needs to be executed once.

## TODO ##
* ~~Implement VirusTotal scanner~~
* ~~Save history per image based on image hash~~
* ~~Configuration file to store Volatility path & VT API key etc. & config dir param~~
* Cache builder: cache most common Volatility commands for all specified images
* Cache results of VirusTotal

## Dependencies
* readline (aka pyreadline on Windows)
* requests

## Configuration ##
Configuration is stored in the file `~/.malware-finder/config`. The following
configuration options are available:
* `volatility`
* `cache`
* `dump`
* `profile`
* `vt_api_key`
* `vt_workers`

Options specified in the configuration file are used as default values and will
be overwritten by any options specified on the command line.

### Windows ###
Create the file `C:\users\YOUR_USER\.malware-finder\config` with the following content:
```ini
[DEFAULT]
volatility = PATH_TO_YOUR_VOLATILITY_EXECUTABLE
vt_api_key = YOUR_VIRUSTOTAL_API_KEY
```

### UNIX-like systems ###
```bash
cat <<'EOF' > ~/.malware-finder/config
[DEFAULT]
volatility = PATH_TO_YOUR_VOLATILITY_EXECUTABLE
vt_api_key = YOUR_VIRUSTOTAL_API_KEY
EOF
```

## Usage ##
```
usage: malware-finder.py [-h] [-C CONFIG_FILE] [-v VOLATILITY] [-c CACHE]
                         [-d DUMP] [-p PROFILE] [-a VT_API_KEY]
                         [-w VT_WORKERS]
                         image

positional arguments:
  image                 Path to the image to analyze

optional arguments:
  -h, --help            show this help message and exit
  -C CONFIG_FILE, --config-file CONFIG_FILE
                        Path to the configuration file (default: ~/.malware-finder/config)
  -v VOLATILITY, --volatility VOLATILITY
                        Path to the volatility executable (default: volatility)
  -c CACHE, --cache CACHE
                        Path to the caching directory (default: cache)
  -d DUMP, --dump DUMP  Path where to drop binary dumps (default: dump)
  -p PROFILE, --profile PROFILE
                        Image's volatility profile
  -a VT_API_KEY, --vt-api-key VT_API_KEY
                        VirusTotal API key
  -w VT_WORKERS, --vt-workers VT_WORKERS
                        Amount of VirusTotal workers (default: 4)
```

## FAQ (Fukkin Annoyin Questionz) ##
### sir plz halp, me no haz ViruzTotalz api key, where i can haz such key? ###
Go to https://www.virustotal.com/ and register an account. Once you manage to
log yourself in, go to
https://www.virustotal.com/en/user/<YOU_USERNAME_HERE>/apikey/ and bam, you're
done buddy! Thank u, come again.

## Usage example ##
```
$ ./malware-finder.py images/image07.raw
SHA512 checksum: 0b290970eb65043e99310575f10585d4868cc4cd5234dcabbde891cf02a29e8dd218fa9f72f7ebce0a6e04125143a5bc04d90cb837b70bd2a8f9cbc2ca482fe4
Testing profile "Win7SP0x86"
Profile: Win7SP0x86
image07.raw> help
Internal commands:
* apihooks
* correlate
* dlllist
* evildll
* evilps
* hollow
* identify
* imageinfo
* ldrmodules
* malfind
* printkey_autostart
* pslist
* psxview
* strings
* vadinfo
* vt
image07.raw> :vt -p 1820
Executing "procdump --dump-dir=dump --pid=1820"
Uploading "dump/executable.1820.exe" (2.5 MiB) to VirusTotal
Detection rate: 2/56 (3%)
Scan date: 2017-01-28 15:11:16
URL: https://www.virustotal.com/file/e63ff30937f5ed6ecabea5d41338407dfb7d18e8a34347f48a2da4dd5a619530/analysis/1485616276/

Amount Malware
     1 HEUR/QVM10.1.0000.Malware.Gen
     1 malicious_confidence_89% (D)
image07.raw> :vt -p 2180 -a 1638400
Executing "dlldump --dump-dir=dump --pid=2180 --base=1638400"
Uploading "dump/module.2180.3fd9da58.190000.dll" (30.5 KiB) to VirusTotal
Detection rate: 3/57 (5%)
Scan date: 2017-01-28 15:30:37
URL: https://www.virustotal.com/file/a0a297b2b5d1089dc2c70674727e0a3ccecf3fd582a171562dacbc548622bbe1/analysis/1485617437/

Amount Malware
     1 HEUR/QVM40.1.0000.Malware.Gen
     1 malicious_confidence_84% (D)
     1 Packed.CPEX-based.cda
image07.raw> 
```
